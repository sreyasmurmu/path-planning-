<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Push Back Field Map – Standalone</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts (optional) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    </style>
  </head>
  <body class="bg-white">
    <div id="root"></div>

    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel Standalone for inline JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Inline App -->
    <script type="text/babel" data-presets="react">
      // Minimal UI primitives to replace shadcn/ui
      const Card = ({ className = "", children }) => (
        <div className={`rounded border border-gray-300 shadow-sm bg-white ${className}`}>{children}</div>
      );
      const CardContent = ({ className = "", children }) => (
        <div className={`p-4 ${className}`}>{children}</div>
      );
      const Button = ({ children, onClick, variant }) => {
        const base = "px-3 py-2 rounded text-sm font-medium";
        const styles = variant === "destructive"
          ? "bg-red-600 hover:bg-red-700 text-white"
          : "bg-blue-600 hover:bg-blue-700 text-white";
        return (
          <button onClick={onClick} className={`${base} ${styles}`}>
            {children}
          </button>
        );
      };

      // Field constants
      const FIELD_SIZE = 144; // inches
      const TILE_COLORS = ["#d9d9d9", "#cfcfcf"];
      const fieldObjects = [
        { name: "Center Zone", x: 72, y: 72, type: "zone" },
        { name: "Top Goal Zone", x: 72, y: 120, type: "zone" },
        { name: "Bottom Goal Zone", x: 72, y: 24, type: "zone" },
        { name: "Neutral Object A", x: 36, y: 72, type: "object" },
        { name: "Neutral Object B", x: 108, y: 72, type: "object" },
        { name: "Neutral Object C", x: 72, y: 36, type: "object" },
        { name: "Neutral Object D", x: 72, y: 108, type: "object" }
      ];

      function PushBackMap() {
        const [robotPose, setRobotPose] = React.useState({ x: 18, y: 18, theta: 0 });
        const [controlPoints, setControlPoints] = React.useState([]);

        const handleFieldClick = (e) => {
          const rect = e.currentTarget.getBoundingClientRect();
          const x = ((e.clientX - rect.left) / rect.width) * FIELD_SIZE;
          const y = (1 - (e.clientY - rect.top) / rect.height) * FIELD_SIZE;
          setControlPoints([...controlPoints, { x, y }]);
        };

        const generateCurve = () => {
          if (controlPoints.length < 2) return "";
          return controlPoints
            .map((p) => `chassis.follow(${p.x.toFixed(1)}, ${p.y.toFixed(1)});`)
            .join("\n");
        };

        return (
          <div className="p-6 space-y-6">
            <h1 className="text-3xl font-bold">VEX Push Back – Advanced Autonomous Path Planner</h1>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {/* FIELD MAP */}
              <Card className="md:col-span-2">
                <CardContent>
                  <div className="relative w-full aspect-square border" onClick={handleFieldClick}>
                    {/* FIELD TILES */}
                    {[...Array(6)].map((_, row) =>
                      [...Array(6)].map((_, col) => (
                        <div
                          key={`${row}-${col}`}
                          className="absolute"
                          style={{
                            left: `${(col / 6) * 100}%`,
                            bottom: `${(row / 6) * 100}%`,
                            width: "16.66%",
                            height: "16.66%",
                            backgroundColor: TILE_COLORS[(row + col) % 2]
                          }}
                        />
                      ))
                    )}

                    {/* Robot */}
                    <div
                      className="absolute w-4 h-4 bg-green-600 rounded-full z-10"
                      style={{
                        left: `${(robotPose.x / FIELD_SIZE) * 100}%`,
                        bottom: `${(robotPose.y / FIELD_SIZE) * 100}%`,
                        transform: "translate(-50%, 50%)"
                      }}
                    />

                    {/* Field Objects */}
                    {fieldObjects.map((obj, i) => (
                      <div
                        key={i}
                        className={`absolute z-10 ${obj.type === "zone" ? "bg-blue-500" : "bg-red-500"}`}
                        style={{
                          left: `${(obj.x / FIELD_SIZE) * 100}%`,
                          bottom: `${(obj.y / FIELD_SIZE) * 100}%`,
                          width: obj.type === "zone" ? "24px" : "14px",
                          height: obj.type === "zone" ? "24px" : "14px",
                          transform: "translate(-50%, 50%)",
                          borderRadius: obj.type === "zone" ? "20%" : "50%"
                        }}
                      />
                    ))}

                    {/* Control Points */}
                    {controlPoints.map((p, i) => (
                      <div
                        key={i}
                        className="absolute w-3 h-3 bg-purple-600 rounded-full z-20"
                        style={{
                          left: `${(p.x / FIELD_SIZE) * 100}%`,
                          bottom: `${(p.y / FIELD_SIZE) * 100}%`,
                          transform: "translate(-50%, 50%)"
                        }}
                      />
                    ))}
                  </div>
                </CardContent>
              </Card>

              {/* CONTROL PANEL */}
              <Card>
                <CardContent className="space-y-4">
                  <h2 className="text-xl font-semibold">Path Controls</h2>
                  <p className="text-sm text-gray-600">
                    Click anywhere on the field to place control points. These points
                    form a smooth motion profile similar to Echo's path planner.
                  </p>

                  <Button onClick={() => setControlPoints([])} variant="destructive">
                    Clear Path
                  </Button>

                  <div className="pt-4 border-t">
                    <h3 className="font-semibold">Robot Start Pose</h3>
                    <p>X: {robotPose.x.toFixed(1)}</p>
                    <p>Y: {robotPose.y.toFixed(1)}</p>
                    <p>θ: {robotPose.theta}°</p>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* AUTON EXPORT */}
            <Card>
              <CardContent>
                <h2 className="text-xl font-semibold mb-2">Generated LemLib Trajectory</h2>
                {controlPoints.length < 2 ? (
                  <p className="text-sm text-gray-500">Add at least two control points</p>
                ) : (
                  <pre className="bg-gray-100 p-4 rounded text-sm">{generateCurve()}</pre>
                )}
              </CardContent>
            </Card>

            {/* NOTES */}
            <Card>
              <CardContent className="text-sm text-gray-700 space-y-2">
                <p><strong>Planner Type:</strong> Smooth trajectory (curve-based)</p>
                <p><strong>Inspired by:</strong> 2654E Echo path planning workflow</p>
                <p><strong>Best Use:</strong> Skills & match autonomous with MCL</p>
              </CardContent>
            </Card>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<PushBackMap />);
    </script>
  </body>
</html>
